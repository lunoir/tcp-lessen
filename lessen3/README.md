# linuxでネットワークプログラミングするときに使用するシステムコールについて

よく使うシステムコールの概要だけさらっと解説します。

linuxにおいては通信もI/Oの一種になります。
そのため、linuxでネットワークプログラミングを行う時はI/Oを多重化するシステムコールを利用します。
ノンブロッキングI/Oや非同期I/Oについての解説は省略します。資料が色々ネット上にあるので調べてみてください。
代表的なものとして下記がよく使用されます。

- select
- poll
- epoll

また余談ですが、通信がI/Oということはファイルディスクリプタ（以下FD）を消費します。
1サーバが受け入れ可能なクライント数の上限がFDにも依存するので、チューニングする際は忘れないようにしてください。

## select

https://linuxjm.osdn.jp/html/LDP_man-pages/man2/select.2.html

- FDを順に確認していく
  - そのため計算量はO(n)になる
- FDセットサイズに上限がある

監視するFDが増えるごとにパフォーマンスが劣化する

## poll

https://linuxjm.osdn.jp/html/LDP_man-pages/man2/poll.2.html

- FDを順に確認していく
  - そのため計算量はO(n)になる
- FDセットサイズ制限なし

select使うよりは普通はpoll使う
select使う場面があるのかは謎
selectと同様に監視するFDが増えるごとにパフォーマンスが劣化する

## epoll

https://linuxjm.osdn.jp/html/LDP_man-pages/man7/epoll.7.html
https://alpha.mixi.co.jp/entry/2007/10631/

- FD状態をカーネルが管理してくれるため、計算量はO(1)になる
  - 読み取り可能なFDしか返ってこない

selectやpollに比べて圧倒的なパフォーマンスを発揮する
epollが使える環境では選択肢はこれ一択となる

### トリガー

エッジトリガーとレベルトリガーは電子工学の分野の用語
エッジトリガーは信号の立ち上がりや下りを検出する
レベルトリガーは信号の状態を「継続的に」検出する

https://w.atwiki.jp/kumikomi-yitjc/pages/39.html

epollにおけるトリガーとしては、FDの状態に対応する
エッジトリガーの方が処理負荷が下がることが期待できるが、イベントの処理に失敗すると次回またイベントが発生しないとepoll_waitが返ってこないので注意

